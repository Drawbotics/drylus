# ExtractEmotionPlugin


Very basic plugin to do one thing: extract into a css bundle the CSS generated by [emotion](https://github.com/emotion-js/emotion).

### Why should I use this?
We created this plugin for a specific use case, where React is the main source of the library (including CSS styling), and we wanted to generate a vanilla JS version of our library. Instead of replicating the CSS twice in `emotion` and in pure CSS, we made a plugin to get all the styles into a separate bundle.

We did this because `emotion` generates classnames and applies styles at runtime, meaning it can't be extracted by standard plugins currently available, like MiniCSSExtractPlugin.

Because of this, we can't truly generate a "JS-only" bundle + a "CSS-only" bundle when using `emotion`. The main entry using `emotion` will still come with the CSS generated at runtime. We use `ExtractEmotionPlugin` to create a _separate_ bundle for the CSS only, which will be used elsewhere.

__Prerequisite Notes__
The plugin should be used with `babel-loader` since it assumes the code in the entry point is already babelified. It also requires `babel-emotion-plugin` to babelifiy the emotion output.

### Install:
```
npm install -D @drawbotics/extract-emotion-plugin
```

### Usage:
```js
// webpack.config.js

const ExtractEmotionPlugin = require('@drawbotics/extract-emotion-plugin');


module.exports = {
  entry: {
    app: './index.js',
    emotion: './components-source.js',
  },
  plugins: [
    new ExtractEmotionPlugin({
      prefix: 'my-class-prefix',
      bundleName: 'emotion',
      filename: '[name].css',
    }),
  ],
  module: {
    rules: [
      {
        test: /\.jsx?$/,
        use: ['babel-loader'],
      },
    ],
  },
};
```

You can use this in two ways:
1. Have multiple entry points, one to generate your bundle as usual, and another to generate the CSS. This is needed because you may still want to have a JS bundle output, but also include a `styles.css` with your library, which can be used somewhere else. In this case you have to specify to the plugin which entry point to use:
```js
module.exports = {
    entry: {
      app: './index.js',
      emotion: './index.js',
    },
    plugins: [
      new ExtractEmotionPlugin({
        bundleName: 'emotion',
        filename: '[name].css',
      }),
    ],
};
```
`app` is the bundle which will be generated by the rest of the webpack compilation, while `emotion` (can be called something else) is the entry used to get the CSS out. The name has to match the `bundleName` option given to `ExtractEmotionPlugin`, otherwise an error will be thrown.
__Note__: The entry point file does not have to be the same.

2. Have 1 entry point (`main.js` by default) from which the CSS will be generated. Be aware that `ExtractEmotionPlugin` essentially replaces the bundle with the CSS-only one. E.g.

```js
module.exports = {
  entry: './index.js',
  plugins: [
    new ExtractEmotionPlugin({
      filename: 'my-css-bundle.css',
    }),
  ],
};
```
This will generate a `my-css-bundle.css` file in your output directory, and no JS will be exported.


### Options
- `filename`: Name of the generated CSS bundle. If `[name]` is passed, it will use the same name as the entry point/bundle name.
- `bundleName`: Required if using multiple entries (object only) to match the entry to the bundle
- `prefix`: `emotion` automatically adds a hash to its classnames, this library removes the hashes by default to have more control over the vanilla CSS export. You can then use a custom prefix to prepend to all the classes.
